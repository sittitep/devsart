---
title: ‡∏ó‡∏≥ CD ‡∏î‡πâ‡∏ß‡∏¢ Github Action ‡πÉ‡∏ô 3 ‡∏ô‡∏≤‡∏ó‡∏µ
author: sittitep
categories:
- github
- CI/CD
- devops
layout: post
date: '2020-06-01 08:00:00'
image: assets/images/post/github-action-3-mins-thumbnail.jpg
---

> tl;dr CICD ‡∏¢‡πà‡∏≠‡∏°‡∏≤‡∏à‡∏≤‡∏Å Continuous integration and continuous delivery ‡∏ú‡∏°‡∏Ç‡∏≠‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡∏Å‡πá‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡πá‡∏Ñ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏Å‡∏≤‡∏£ run unitest, build, packing ‡πÑ‡∏õ‡∏à‡∏ô deploy ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏Ñ‡∏£‡∏à‡∏∞‡∏°‡∏µ flow ‡πÅ‡∏ö‡∏ö‡∏≠‡∏∑‡πà‡∏ô‡∏Å‡πá‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡πà‡∏à‡∏∞‡πÉ‡∏™‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ [‡∏≠‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠](https://blog.twinsynergy.co.th/getting-started-with-gitlab-cicd/){:target="_blank"}
> 

‡∏Ñ‡∏á‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ß‡πà‡∏≤ CI/CD ‡πÑ‡∏î‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÑ‡∏õ‡∏ã‡∏∞‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏ô‡∏≠‡∏î‡∏µ‡∏ï‡πÄ‡∏£‡∏≤‡∏°‡∏±‡∏Å‡∏à‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏±‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÉ‡∏ô local ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡∏ß‡∏±‡∏î‡∏î‡∏ß‡∏á‡∏ï‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô production ‡∏ã‡∏∂‡πà‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡∏î‡∏ß‡∏á‡πÄ‡∏£‡∏≤‡∏°‡∏±‡∏Å‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏Ñ‡πà‡∏≠‡∏¢‡∏î‡∏µ ‡πÅ‡∏•‡∏∞ ‡∏°‡∏µ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏±‡∏ô‡∏ï‡∏•‡∏≠‡∏î üòÖüòÖüòÖ

![it works on my machine](https://i.imgflip.com/9mqg4.jpg)

‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÉ‡∏ô‡∏≠‡∏î‡∏µ‡∏ï CI/CD ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡πà‡∏≤‡∏¢‡πÜ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô ‡πÉ‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÄ‡∏£‡∏≤‡∏°‡∏µ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏°‡∏≤‡∏Å‡∏°‡∏≤‡∏¢ ‡πÄ‡∏ä‡πà‡∏ô [CircleCi](https://circleci.com/){:target="_blank"}, [semaphoreci](https://semaphoreci.com/){:target="_blank"} ‡πÅ‡∏•‡∏∞ [Buildkite](https://buildkite.com/){:target="_blank"} ‡πÅ‡∏ï‡πà tool ‡∏ó‡∏µ‡πà‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡∏≠‡∏°‡∏™‡∏¢‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠ Github ‡∏™‡πà‡∏á [Actions](https://github.com/features/actions){:target="_blank"} ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô CI/CD ‡∏°‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ô‡πÅ‡∏ö‡∏ö‡∏ü‡∏£‡∏µ‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢‡πÄ‡∏ß‡∏•‡∏≤ ‡πÄ‡∏£‡∏≤‡πÑ‡∏õ‡∏î‡∏π‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏¢‡∏ß‡πà‡∏≤‡∏°‡∏±‡∏ô‡∏à‡∏∞‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏´‡∏ô
## ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß
1.  **Host** ‡πÉ‡∏ô‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏ú‡∏°‡πÉ‡∏ä‡πâ DigitalOcean ‡∏ï‡∏±‡∏ß‡∏ñ‡∏π‡∏Å‡∏™‡∏∏‡∏î ‡πÅ‡∏•‡∏∞ ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà DEVSART ‡πÉ‡∏ä‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏ß‡∏¢

2. **Github** ‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô‡∏ß‡πà‡∏≤‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ feature ‡∏Ç‡∏≠‡∏á Github ‡∏¢‡πà‡∏≠‡∏°‡∏ï‡πâ‡∏≠‡∏á ‡πÄ‡∏Å‡πá‡∏ö code ‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà Github

3. **Deploy Script** ‡∏Ñ‡∏∑‡∏≠ ‡πÑ‡∏ü‡∏•‡πå shell script ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ deploy ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤

## ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô
### 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå  workflow
```
# /Users/sittitep/projects/devsart/.github/workflows/cd.yml

name: CD #‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡πÉ‡∏à‡∏ä‡∏≠‡∏ö‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö

on: #‡∏ï‡∏£‡∏á‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ô action ‡∏ô‡∏µ‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£ push ‡∏´‡∏£‡∏∑‡∏≠ merge pull request ‡πÑ‡∏õ‡∏¢‡∏±‡∏á master
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:
    runs-on: ubuntu-latest
    #‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ ssh ‡πÄ‡∏Ç‡πâ‡πà‡∏≤‡∏¢‡∏±‡∏á host ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤ ‡πÅ‡∏•‡∏∞ ‡∏£‡∏±‡∏ô deploy.sh
    steps:
    - uses: actions/checkout@v2
    - name: SSH Commands 
      uses: appleboy/ssh-action@master
      with:
        host: 167.71.209.134 # IP ‡∏Ç‡∏≠‡∏á host ‡πÄ‡∏£‡∏≤
        username: root # username ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ
        key: {{"${{ secrets.KEY "}}}} # key ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠ ssh key ‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á host ‡πÑ‡∏î‡πâ
        port: 22
        script: |
          ./deploy.sh

```
### 2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ key ‡∏ö‡∏ô Github
‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå workflow ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÄ‡∏£‡∏≤‡∏Å‡πá‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏õ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ key  ‡∏ö‡∏ô Github ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Github Action  ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ ssh ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á host ‡πÑ‡∏î‡πâ

![github-secret]({{ 'assets/images/post/ github-secret.jpg' | relative_url }})
### 3. ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á depoy script
‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÑ‡∏ü‡πå deploy script ‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á host ‡∏ã‡∏∂‡πà‡∏á location ‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö location ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå workflow ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö
```
# ~/deploy.sh

cd ~/devsart
git reset --hard
git clean -fd
git pull origin master
docker build . -t devsart --no-cache
docker-compose down && docker-compose up -d
docker system prune -f
```

‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏∂‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á Github Action ‡∏Å‡πá‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤ push ‡πÑ‡∏õ‡∏¢‡∏±‡∏á master 

![github-actions]({{ 'assets/images/post/github-actions.jpg' | relative_url }})
##  ‡∏™‡∏£‡∏∏‡∏õ
Github Actions ‡∏Å‡πá‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÅ‡∏¢‡πà ‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏≤‡∏ù‡∏≤‡∏Å Git ‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏≤‡∏£ Integration ‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏™‡∏∞‡∏î‡∏ß‡∏Å ‡πÅ‡∏ï‡πà‡∏Å‡πá‡πÉ‡∏ä‡πâ‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢ Github Actions ‡∏à‡∏≥‡∏Å‡∏±‡∏î build time ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö free-tier ‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà 2,000 ‡∏ô‡∏≤‡∏ó‡∏µ ‡πÅ‡∏ï‡πà‡πÄ‡∏≠‡∏≤‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡∏ú‡∏°‡∏Å‡πá‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡πÇ‡∏î‡∏¢‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏±‡∏Å‡∏ó‡∏µ üòÇ

### Reference
1. [Getting started with gitlab CICD](https://blog.twinsynergy.co.th/getting-started-with-gitlab-cicd/){:target="_blank"}
